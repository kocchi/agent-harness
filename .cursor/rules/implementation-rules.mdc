---
description: agent-harness の実装ルール。バーティカルスライス、Human-in-the-Loop、FICプロトコル。
alwaysApply: true
---

# implementation-rules

## バーティカルスライス実行

変更は Plan→実装→検査を一貫して完結させる

__必須__:
- Plan フェーズで rules-validator サブエージェントを呼び出す
- ルールを変えたら実装も変える
- サブエージェント/スキル作成後は動作検証を行う
- コミット前に rules-validator サブエージェントを呼び出す

## コミット前レビュー

コミット前に中間生成物での合意を必須とする（Human-in-the-Loop）

__必須__:
- コミット前にユーザーに変更サマリを提示する
- 中間生成物（契約・失敗モード・テスト戦略）を明示する
- ユーザーの承認を得てからコミットする

__禁止__:
- ユーザーの承認なしにコミットしない
- 一行ずつのコードレビューを強要しない

## 場の開催（スキップ禁止）

Sprint Planning / Review / Retro は**場**として開催する。persona-council に委譲してから契約を作成する。

__必須__:
- sprint-goal-contract を作成・更新する前に、**persona-council に委譲して Sprint Planning 場を開催する**
- insight-contract を Review/Retro で作成・更新する前に、**persona-council に委譲して Sprint Review / Retro 場を開催する**
- 議論の過程を research/discussions/ に記録する
- 契約に議論ログへの参照（discussion_ref）を含める

__禁止__:
- 場を開催せずに sprint-goal-contract を直接作成・更新すること
- 場を開催せずに Review/Retro の insight-contract を直接作成・更新すること

## サブエージェントルーティング

タスクを適切な実行パターン（並列/順次/バックグラウンド）にルーティングする

__必須__:
- Plan フェーズで並行分割を検討する
- 実行パターン（parallel/sequential/background）を明示する
- 独立タスクは並列 Tool Call で実行する

## FIC セッションプロトコル

FIC（P5）を使った議論では、憲法を先にインストールする

__必須__:
- FIC セッション開始時に憲法（P1-P6）を明示的にインストールする
- 各人格（サブエージェント）に憲法を伝える
- 手段の目的化を防止する（なぜ？何が得られる？を定期確認）
- セッション終了後にレトロスペクティブを実施する
